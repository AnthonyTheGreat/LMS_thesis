angular.module("lmsApp",["ngRoute","ngAnimate","angularCSS","oc.lazyLoad","firebase","ui.bootstrap"]),angular.module("lmsApp").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{title:"STC Learning Management System",templateUrl:"view/home.html",css:"style/home.css",controller:"loginCtrl",data:{requireAuth:"none"}}).when("/home",{title:"STC Learning Management System",templateUrl:"view/home.html",css:"style/home.css",controller:"loginCtrl",data:{requireAuth:"none"}}).when("/profile_info/:user",{title:"STC Learning Management System",templateUrl:"view/profileInfo.html",css:"style/signup.css",controller:"profileInfoCtrl",data:{requireAuth:"none"}}).when("/student_page",{title:"Student page",templateUrl:"view/student/student_page.html",controller:"TabsDemoCtrl",css:[{href:"style/profile.css",preload:!0},{href:"style/student-page.css",preload:!0}],data:{requireAuth:["teacher","student"]},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}],currentUser:[function(){return firebase.auth().currentUser}]}}).when("/profile",{title:"Profile",templateUrl:"view/studentProfile.html",css:"style/profile.css",controller:"studentProfile",data:{requireAuth:"none"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}],currentUser:[function(){return firebase.auth().currentUser}]}}).when("/about",{title:"About Us",templateUrl:"view/about.html",css:[{href:"style/home.css",preload:!0},{href:"style/aboutus.css",preload:!0}],data:{requireAuth:"none"}}).when("/signup",{title:"Sign Up",templateUrl:"view/signup.html",css:"style/signup.css",controller:"signupCtrl",data:{requireAuth:"none"}}).when("/class_dashboard/class_recordList",{title:"Manage your class",templateUrl:"view/classDash/classRecord.html",css:["style/classDash/component.css","style/classDash/default.css","style/classDash/classdash.css"],data:{requireAuth:"none"},resolve:{lazy:["$ocLazyLoad",function(e){return e.load({files:["lib/classie.js","lib/modernizr.custom.js"]})}]}}).when("/class_dashboard/class_recordThumb",{title:"Manage your class",templateUrl:"view/classDash/classRecord2.html",css:["style/classDash/component.css","style/classDash/default.css","style/classDash/classdash.css"],data:{requireAuth:["teacher","student"]},resolve:{lazy:["$ocLazyLoad",function(e){return e.load({files:["lib/classie.js","lib/modernizr.custom.js"]})}]}}).when("/class_dashboard/resources",{title:"Manage your class",templateUrl:"view/classDash/classResources.html",css:["style/classDash/component.css","style/classDash/default.css","style/classDash/classdash.css"],data:{requireAuth:["teacher","student"]},resolve:{lazy:["$ocLazyLoad",function(e){return e.load({files:["lib/modernizr.custom.js","lib/classie.js"]})}]}}).when("/class_dashboard/createannouncement",{title:"Manage your class",templateUrl:"view/classDash/announcementtab.html",css:["style/classDash/component.css","style/classDash/default.css","style/classDash/classdash.css"],data:{requireAuth:["teacher","student"]},resolve:{lazy:["$ocLazyLoad",function(e){return e.load({files:["lib/modernizr.custom.js","lib/classie.js"]})}]}}).when("/class_dashboard/createassignment",{title:"View your resources",templateUrl:"view/classDash/assignmenttab.html",css:["style/classDash/component.css","style/classDash/default.css","style/classDash/classdash.css"],data:{requireAuth:"teacher"},resolve:{lazy:["$ocLazyLoad",function(e){return e.load({files:["lib/modernizr.custom.js","lib/classie.js"]})}]}}).when("/class_dashboard/createquiz",{title:"Manage your class",templateUrl:"view/classDash/quiztab.html",css:["style/classDash/component.css","style/classDash/default.css","style/classDash/classdash.css"],controller:"createQuizCtrl",data:{requireAuth:"teacher"},resolve:{lazy:["$ocLazyLoad",function(e){return e.load({files:["lib/modernizr.custom.js","lib/classie.js"]})}]}}).when("/group",{title:"Your Groups",templateUrl:"view/group/group.html",controller:"groupCtrl",css:[{href:"style/group.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:["teacher","student"]},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/group/page",{title:"Your Groups",templateUrl:"view/group/group_page.html",css:[{href:"style/group.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:["teacher","student"]},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/group/page",{title:"Your Groups",templateUrl:"view/group/group_page.html",css:[{href:"style/group.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:["teacher","student"]},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/forum_home",{title:"Latest Forum Topics",templateUrl:"view/forum_home.html",css:[{href:"style/forum/forum_home.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:"none"}}).when("/start_quiz",{title:"start quiz",templateUrl:"view/student/start_quiz.html",requireAuth:!1,css:[{href:"style/profile.css",preload:!0},{href:"style/student_quiz.css",preload:!0}],data:{requireAuth:"none"}}).when("/take_quiz",{title:"take quiz",templateUrl:"view/student/student_quiz.html",controller:"PaginationDemoCtrl",css:[{href:"style/profile.css",preload:!0},{href:"style/student_quiz.css",preload:!0}],data:{requireAuth:"none"}}).when("/forum_post",{title:"Forum",templateUrl:"view/forum_post.html",css:[{href:"style/forum/forum_post.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:"none"}}).when("/create_forum_form",{title:"Create Forum",templateUrl:"view/create_forum_form.html",controller:"addForumCtrl",css:[{href:"style/profile.css",preload:!0},{href:"style/forum/forum_home.css",preload:!0}],data:{requireAuth:["teacher","student"]},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin",{title:"Admin Page",templateUrl:"view/admin/home.html",css:"style/admin.css",controller:"adminUsersCtrl",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/schedule",{title:"Admin Page",templateUrl:"view/admin/schedule.html",css:"style/admin.css",controller:"adminScheduleCtrl",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/groups",{title:"Admin Page",templateUrl:"view/admin/groups.html",css:"style/admin.css",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/events",{title:"Admin Page",templateUrl:"view/admin/events.html",css:{href:"style/admin.css",preload:!0},controller:"eventsCtrl",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/sections",{title:"Admin Page",templateUrl:"view/admin/sections.html",css:{href:"style/admin.css",preload:!0},controller:"eventsCtrl",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/subjects",{title:"Admin Page",templateUrl:"view/admin/subjects.html",css:{href:"style/admin.css",preload:!0},controller:"aSubjectsCtrl",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/forum",{title:"Admin Page",templateUrl:"view/admin/forum.html",css:"style/admin.css",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/admin/forum_topics",{title:"Admin Page",templateUrl:"view/admin/forum_topics.html",css:"style/admin.css",data:{requireAuth:"admin"},resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/teacher/uploads",{title:"Uploads Page",templateUrl:"view/teacher/uploads.html",css:[{href:"style/teacher/uploads.css ",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:"none"}}).when("/teacher/classes",{title:"Classes Page",templateUrl:"view/teacher/classes.html",css:[{href:"style/teacher/classes.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:"none"}}).when("/teacher/home",{title:"Home Page",templateUrl:"view/teacher/homeMenubars.html",contoller:"oververiewCtrl",css:[{href:"style/teacher/home.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:"none"}}).when("/teacher/assignment",{title:"Assignment Page",templateUrl:"view/teacher/assignments.html",css:[{href:"style/teacher/assignments.css",preload:!0},{href:"style/profile.css",preload:!0}],data:{requireAuth:"none"}}).otherwise({redirectTo:"/",data:{requireAuth:"none"}})}]),angular.module("lmsApp").run(["$rootScope",function(e){e.$on("$routeChangeSuccess",function(t,r,a){r.hasOwnProperty("$$route")&&(e.title=r.$$route.title)})}]),angular.module("lmsApp").controller("addForumCtrl",["$scope","Forum",function(e,t){e.addForum=function(r){console.log(r),t.addForum(r),e.forum={titles:"",contents:""},console.log("added")}}]),angular.module("lmsApp").controller("createQuizCtrl",["$scope","Questions",function(e,t){var r=firebase.database().ref("/quiz");e.setQuiz=function(e){var a=r.push({q_num:e.qnum,q_title:e.qtitle,q_type:e.qtype}).key;console.log(a),t.setKey(a)},e.QuestionData=[],e.addQuiz=function(t){e.QuestionData.push({q_question:t.quest,q_answer:t.answer,q_dummy1:t.dummy1,q_dummy2:t.dummy2,q_dummy3:t.dummy3}),console.log("add quiz")},e.saveQuiz=function(){console.log(t.getKey()),t.addQuiz(e.QuestionData,t.getKey()),console.log("save")}}]),angular.module("lmsApp").controller("loginCtrl",["$scope","$firebaseAuth","$firebaseArray","$location",function(e,t,r,a){e.authObj=t();var s=firebase.database().ref("/users");r(s);e.LoginFacebook=function(){e.authObj.$signInWithPopup("facebook").then(function(e){n(e.user.uid)})},e.LoginGoogle=function(){e.authObj.$signInWithPopup("google").then(function(e){n(e.user.uid)})},e.LoginEmail=function(t){e.authObj.$signInWithEmailAndPassword(t.email,t.password).then(function(e){n(e.user.uid)})["catch"](function(e){console.log(e)})};var n=function(e){s.child(e).on("value",function(t){var r=firebase.auth().currentUser;null!==t.val()?s.child(e).on("value",function(e){var t=e.val().utype;switch(t){case"student":a.path("/student_page");break;case"teacher":a.path("/profile");break;case"admin":a.path("/admin");break;default:a.path("/profile_info/"+r.uid)}}):a.path("/profile_info/"+r.uid)})}}]),angular.module("lmsApp").controller("PaginationDemoCtrl",["$scope",function(e){e.totalItems=100}]),angular.module("lmsApp").controller("profileInfoCtrl",["$scope","$firebaseObject","$location","$routeParams","$firebaseAuth",function(e,t,r,a,s){e.profileInfo={utype:"student"};var n=s(),l=n.$getAuth(),o=a.user,i=firebase.database().ref("/users/"+o),u=t(i),c=new Date(Date.now()).toLocaleString();e.submitInfo=function(e){u.utype=e.utype,u.firstname=e.firstname,u.lastname=e.lastname,u.description=e.Description,u.email=l.email,u.dateCreated=c,u.dateSignedIn=c,u.isActive=!0,u.$save().then(function(e){i.update({uid:e.key}),l?r.path("/profile"):r.path("/")})["catch"](function(e){console.log(e)})}}]),angular.module("lmsApp").controller("signupCtrl",["$scope","$firebaseArray","$firebaseAuth","$location",function(e,t,r,a){e.load=!1;var s=r(),n=firebase.database().ref("/users");t(n);e.LoginFacebook=function(){s.$signInWithPopup("facebook").then(function(e){a.path("/profile_info/"+e.user.uid)})["catch"](function(t){e.load=!1,alert("Authentication failed: ",t.message)})},e.LoginGoogle=function(){s.$signInWithPopup("google").then(function(e){a.path("/profile_info/"+e.user.uid)})["catch"](function(t){e.load=!1,alert("Authentication failed: ",t.message)})},e.submitForm=function(t){e.reg_form.$valid&&s.$createUserWithEmailAndPassword(t.email,t.password).then(function(e){a.path("/profile_info/"+e.uid)})["catch"](function(t){e.load=!1,"auth/email-already-in-use"===t.code?alert(t.message):console.log("Auth failed: "+t)})}}]),angular.module("lmsApp").controller("studentProfile",["$scope","$firebaseArray","$firebaseAuth","$location",function(e,t,r,a){e.load=!1;var s=(r(),firebase.database().ref("/users"));t(s)}]),angular.module("lmsApp").controller("TabsDemoCtrl",["$scope",function(e){e.tabs=[{title:"Dynamic Title 1",content:"Dynamic content 1"},{title:"Dynamic Title 2",content:"Dynamic content 2"}],e.model={name:"Tabs"}}]),angular.module("lmsApp").directive("dirAdminNav",["$location",function(e){var t=function(t){t.logOutUser=function(){firebase.auth().signOut(),e.path("/")},t.location=function(t){return t.substr(1)===e.url()}};return{restrict:"E",templateUrl:"components/partials/adminNav.html",link:t}}]),angular.module("lmsApp").directive("dirFileInput",[function(){return{restrict:"A",link:function(e,t,r){var a=e.$eval(r.dirFileInput);t.bind("change",a)}}}]),angular.module("lmsApp").directive("dirLoader",[function(){return{restrict:"E",template:'<div class="loader-wrapper"><div class="loader"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>'}}]),angular.module("lmsApp").directive("dirNav",["$location","LoggedInUser",function(e,t){var r=function(r){function a(e){r.utypePath=e}r.logOutUser=function(){e.path("/"),firebase.auth().signOut()},r.location=function(t){return t.substr(1)===e.url()},r.utypePath,function(){userTypeData=t.getUsertype(),"student"==userTypeData?a("#/student_page"):"teacher"==userTypeData&&a("#/class_dashboard/createquiz")}(),r.name=firebase.auth().currentUser.displayName,r.NotifNum=3,r.MessageNum=2};return{restrict:"A",templateUrl:"components/partials/navbar.html",link:r}}]),angular.module("lmsApp").factory("Events",["$firebaseArray",function(e){function t(){return l}function r(e){l.$add(e)}function a(e){n.child(e).update({isActive:!1})}function s(e){n.child(e).update({isActive:!0})}var n=firebase.database().ref("/events"),l=e(n);return{getEvents:t,addEvent:r,deactivate:a,activate:s}}]),angular.module("lmsApp").factory("File",[function(){function e(e){n=e,console.log(n)}function t(e,t){l=firebase.storage().ref(e+t),console.log(e)}function r(){return o=l.put(n)}function a(e){var t=e.bytesTransferred/e.totalBytes*100;return t}function s(){return l.getDownloadURL()}var n,l,o;return{getFile:e,setStorage:t,upload:r,progress:a,getURL:s}}]),angular.module("lmsApp").factory("Forum",["$firebaseArray",function(e){function t(e){a.$add(e)}var r=firebase.database().ref("forum/"),a=e(r);return{addForum:t}}]),angular.module("lmsApp").factory("Groups",["$firebaseArray",function(e){function t(e,t){s.$add(e).then(function(e){var r=e.key;console.log(e),firebase.database().ref("users/"+t+"/groups").push(r)})}function r(){return grpID}var a=firebase.database().ref("/groups"),s=e(a);return{addGroup:t,getGrpID:r}}]),angular.module("lmsApp").factory("LoggedInUser",[function(){function e(e){a=e}function t(){return a}function r(){return s}var a,s="";return firebase.auth().onAuthStateChanged(function(t){t?(s=t.uid,firebase.database().ref("/users/"+s).on("value",function(t){e(t.val().utype)})):e("noUser")}),{getUsertype:t,getUID:r}}]).service("pageAuth",["$location","$rootScope","LoggedInUser",function(e,t,r){var a=function(t,r,a,s){"AUTH_REQUIRED"===s&&(t.preventDefault(),alert("You must be logged in to access page!"),a&&e.path(a.$$route.originalPath))},s=function(t,a,s,n){function l(e){var r=a.data.requireAuth;if("none"!==r)if(Array.isArray(r)){var s=r.some(function(t){return t===e});s!==!0&&(t.preventDefault(),alert("You are not authorized to access the page!"))}else e!==r&&(t.preventDefault(),alert("You are not authorized to access the page!"))}("/"===e.path()&&"noUser"!==r.getUsertype()||"/home"===e.path()&&"noUser"!==r.getUsertype())&&s&&e.path(s.$$route.originalPath);var o=r.getUsertype();if("noUser"!==o)switch(o){case"teacher":l(o);break;case"student":l(o);break;default:console.log("default")}};t.$on("$routeChangeError",a),t.$on("$routeChangeStart",s)}]),angular.module("lmsApp").run(function(e){}),angular.module("lmsApp").factory("Questions",["$firebaseArray","$firebaseObject",function(e){function t(e){s=e,console.log(s)}function r(){return console.log(s),s}function a(t,r){var a=firebase.database().ref("/quiz/"+r+"/questions"),s=e(a);return s.$save(t).key}var s=(firebase.database().ref("/quiz/"),"");return{addQuiz:a,setKey:t,getKey:r}}]),angular.module("lmsApp").factory("Schedule",["$firebaseArray",function(e){function t(){return l}function r(e){l.$add(e)}function a(e){n.child(e).update({isActive:!1})}function s(e){n.child(e).update({isActive:!0})}var n=firebase.database().ref("/schedule"),l=e(n);return{getSched:t,addSched:r,deactivate:a,activate:s}}]),angular.module("lmsApp").factory("Subjects",["$firebaseArray",function(e){function t(){return l}function r(e){l.$add(e)}function a(e){n.child(e).update({isActive:!1})}function s(e){n.child(e).update({isActive:!0})}var n=firebase.database().ref("/subjects"),l=e(n);return{getSubjects:t,addSubject:r,deactivate:a,activate:s}}]),angular.module("lmsApp").factory("Todo",["$firebaseArray",function(e){function t(){return s}function r(e){s.$add(e)}var a=firebase.database().ref("/todos"),s=e(a);return{getTodos:t,addTodo:r}}]),angular.module("lmsApp").factory("Users",["$firebaseArray",function(e){function t(){return n}function r(e){s.child(e).update({isActive:!1})}function a(e){s.child(e).update({isActive:!0})}var s=firebase.database().ref("/users"),n=e(s);return{getUsers:t,deactivate:r,activate:a}}]),angular.module("lmsApp").controller("adminScheduleCtrl",["$scope","Schedule","Users","Subjects","uibButtonConfig",function(e,t,r,a,s){e.theSchedule=t.getSched(),e.theTeachers=r.getUsers(),e.theSubjects=a.getSubjects(),e.toggleAdd=!0,s.activeClass="btn-primary",e.searchSchedule="",e.sortType="Section",e.sortReverse="false",e.checkAll=function(){e.selectedAll?e.selectedAll=!0:e.selectedAll=!1,angular.forEach(e.theSchedule,function(t){t.Selected=e.selectedAll})},e.deactivate=function(e){console.log(e),t.deactivate(e)},e.activate=function(e){console.log(e),t.activate(e)},e.Days={mon:!1,tue:!0,wed:!1,thu:!1,fri:!1},e.sched={Section:null},e.insertSched=function(e){var r=(new Date).getFullYear(),a=r+1;e.timeStart=e.timeStart.getTime(),e.timeEnd=e.timeEnd.getTime(),e.isActive=!0,e.SY=String(r)+" - "+String(a),t.addSched(e)}}]),angular.module("lmsApp").controller("aSubjectsCtrl",["$scope","Subjects",function(e,t){e.toggleAdd=!0,e.theSubjects=t.getSubjects(),e.load=!1,e.searchSubject="",e.sortType="name",e.sortReverse=!0,e.checkAll=function(){e.selectedAll?e.selectedAll=!0:e.selectedAll=!1,angular.forEach(e.theSubjects,function(t){t.Selected=e.selectedAll})},e.insertSubject=function(r){r.isActive=!0,t.addSubject(r),e.toggleAdd=!toggleAdd},e.deactivate=function(e){t.deactivate(e)},e.activate=function(e){t.activate(e)}}]),angular.module("lmsApp").controller("adminUsersCtrl",["$scope","Users",function(e,t){e.theUsers=t.getUsers(),e.searchUsers="",e.sortType="email",e.sortReverse="false",e.checkAll=function(){e.selectedAll?e.selectedAll=!0:e.selectedAll=!1,angular.forEach(e.theUsers,function(t){t.Selected=e.selectedAll})},e.deactvate=function(e){t.deactivate(e)},e.activate=function(e){t.activate(e)}}]),angular.module("lmsApp").controller("eventsCtrl",["$scope","File","Events",function(e,t,r){e.toggleAdd=!0,e.theEvents=r.getEvents(),e.load=!1;var a=new Date;e.dateNow=a;var s=new Date,n=s.setFullYear(s.getFullYear()+20);e.futureDate=n,e.searchEvents="",e.sortType="name",e.sortReverse=!0,e.checkAll=function(){e.selectedAll?e.selectedAll=!0:e.selectedAll=!1,angular.forEach(e.theEvents,function(t){t.Selected=e.selectedAll})},e.insertEvent=function(a){a.startEvent=a.start.getTime(),a.endEvent=a.end.getTime(),a.isActive=!0,e.load=!0,t.upload().on("state_changed",function(t){console.log(t),e.percent=t.bytesTransferred/t.totalBytes*100},function s(s){console.log(s)},function(){t.getURL().then(function(t){a.url=t,r.addEvent(a),e.load=!1,e.event=null,e.toggleAdd=!0})})},e.deactvate=function(e){r.deactivate(e)},e.activate=function(e){r.activate(e)},e.fileGetter=function(){var e=event.target.files[0];t.getFile(e),t.setStorage("events/",e.name)}}]),angular.module("lmsApp").controller("groupCtrl",["$scope","Groups","LoggedInUser",function(e,t,r){e.setPrivacy=[{code:"Public",privacy:"Public"},{code:"Private",privacy:"Private"}],e.newGroup=function(e){e.created=Math.floor(Date.now()/1e3),e.owner=r.getUID(),t.addGroup(e,e.owner)}}]),angular.module("lmsApp").controller("take_quizCtrl",["$scope","Questions",function(e,t){}]),angular.module("lmsApp").controller("oververiewCtrl",["$scope","Todo",function(e,t){e.theTodos=t.getTodos(),e.task={desc:"add task"},e.addTodos=function(){console.log("Im clicked"),console.log(e.task),t.addTodo()}}]);